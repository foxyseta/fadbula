\documentclass{article}

\usepackage[italian]{babel}
\usepackage[hidelinks]{hyperref}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{mfirstuc}
\usepackage{calc}

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.92,0.92,0.92}

\lstdefinestyle{mystyle}{
	backgroundcolor=\color{backcolour},
	commentstyle=\color{codegreen},
	keywordstyle=\color{blue},
	numberstyle=\tiny\color{codegray},
	stringstyle=\color{codepurple},
	basicstyle=\ttfamily\footnotesize,
	breakatwhitespace=false,
	breaklines=true,
	captionpos=b,
	keepspaces=true,
	numbers=left,
	numbersep=5pt,
	showspaces=false,
	showstringspaces=false,
	showtabs=false,
	tabsize=2
}

\lstset{style=mystyle}

\graphicspath{ {./images/} }

\newcommand{\sqlinputlisting}[2]{
	\lstinputlisting[language=SQL, captionpos=t, caption={#2}]{#1}
}

% File name without extension
\newcommand{\sql}[1]{
	\sqlinputlisting{../src/#1.sql}
	{\texttt{#1.sql}}
}

\title{
	faDBula \\
	\textbf{\large
		Relazione del progetto per l'insegnamento di \break
		Basi di dati
	}
}

\author{
	Ilaria Volpe (\#766012,
	\href{mailto:ilaria.volpe2@studio.unibo.it}{ilaria.volpe2@studio.unibo.it}),
	\\
	Stefano Volpe (\#969766,
	\href{mailto:stefano.volpe2@studio.unibo.it}{stefano.volpe2@studio.unibo.it})
}

\date{
	Alma Mater Studiorum - Universit\`a di Bologna \\
	\today
}

\begin{document}

\maketitle
\thispagestyle{empty}
\pagebreak
\tableofcontents
\pagebreak
\section{Analisi dei requisiti}

\subsection{Requisiti espressi in linguaggio naturale}

Si desidera progettare una base di dati per gli appassionati di una specifica
produzione narrativa letteraria, cinematografica e/o televisiva. Lo scopo è
quello di permettere una facile analisi di trame anche complesse. Si intende
rappresentarne con codice univoco agenti, tempi, luoghi, eventi della fabula,
nonché unità narrative (anacronie e non) dell'intreccio. Sono memorizzati nome,
immagine descrittiva, sesso, momenti di nascita e di morte degli agenti. I
tempi sono rappresentati da intervalli (lineari) o da fasi (di un ciclo): dei
primi sono memorizzati l'istante di inizio e l'istante di fine mentre delle
seconde, il cui codice è progressivo, il nome. I luoghi sono caratterizzati da
nome e coordinate su una data mappa. Le mappe sono descritte da nome, immagine
ed estensione. Gli eventi sono caratterizzati da veridicità, agenti coinvolti,
luogo e intervallo. Uno o più agenti, per un dato intervallo di tempo, possono
pensare che un evento sia avvenuto. Le unità narrative sono descritte da indice,
titolo e intervallo narrato.

\subsection{Glossario dei termini}

\begin{center}\begin{tabular}{|p{0.2\textwidth-2\tabcolsep-1.2\arrayrulewidth}|p{0.55\textwidth-2\tabcolsep-1.2\arrayrulewidth}|p{0.22\textwidth-2\tabcolsep-1.2\arrayrulewidth}|}
		\hline
		\textbf{Termine} & \textbf{Descrizione}                                                                                & \textbf{Collegamenti} \\
		\hline
		Agente           & Personaggio o alias di un personaggio presente nella produzione narrativa                           & Evento                \\
		\hline
		Tempo            & Periodo temporale che occorre una o più volte nella produzione narrativa                            & Evento                \\
		\hline
		Intervallo       & Tempo di tipo lineare                                                                               & Evento                \\
		\hline
		Fase             & Tempo che ricorre una o più volte, ciclicamente                                                     & Evento                \\
		\hline
		Luogo            & Luogo presente nella produzione narrativa in cui possono avvenire eventi                            & Evento, Mappa         \\
		\hline
		Mappa            & Rappresentazione grafica in cui collocare uno o più luoghi                                          & Luogo                 \\
		\hline
		Evento           & Ciò che avviene o è pensato essere avvenuto nella produzione narrativa                              & Agente, Luogo, Tempo  \\
		\hline
		Credenza         & L'atto, da parte di uno o più agenti, di pensare che un evento sia avvenuto                         & Agente, Evento        \\
		\hline
		Unità narrativa  & Elemento della produzione narrativa che include parte, uno o più tempi                              & Tempo                 \\
		\hline
		Fabula           & Elenco degli eventi ordinati cronologicamente rispetto al momento in cui avvengono nella narrazione & Tempo, Intreccio      \\
		\hline
		Intreccio        & Elenco degli eventi ordinati cronologicamente rispetto al momento in cui sono narrati               & Tempo, Fabula         \\
		\hline
	\end{tabular}\end{center}

\subsection{Strutturazione dei requisiti}

\begin{itemize}
	\item \textbf{Frasi di carattere generale}
	      Si desidera progettare una base di dati per gli appassionati di una
	      specifica produzione narrativa letteraria, cinematografica e/o
	      televisiva. Lo scopo è quello di permettere una facile analisi di trame
	      anche complesse. Si intende rappresentarne con codice univoco agenti,
	      tempi, luoghi, eventi della fabula, nonché unità narrative (anacronie e
	      non) dell'intreccio.
	\item \textbf{Frasi relative agli agenti:}
	      Sono memorizzati nome, immagine descrittiva, sesso, momenti di nascita e
	      di morte degli agenti.
	\item \textbf{Frasi relative ai tempi:}
	      I tempi sono rappresentati da intervalli (lineari) o da fasi (di un
	      ciclo): dei primi sono memorizzati l'istante di inizio e l'istante di
	      fine mentre delle seconde, il cui codice è progressivo, il nome.
	\item \textbf{Frasi relative ai luoghi:}
	      I luoghi sono caratterizzati da nome e coordinate su una data mappa.
	\item \textbf{Frasi relative alle mappe:}
	      Le mappe sono descritte da nome, immagine ed estensione.
	\item \textbf{Frasi relative agli eventi:}
	      Gli eventi sono caratterizzati da veridicità, agenti coinvolti, luogo e
	      intervallo. Uno o più agenti, per un dato intervallo di tempo, possono
	      pensare che un evento sia avvenuto.
	\item \textbf{Frasi relative alle unità narrative:}
	      Le unità narrative sono descritte da indice, titolo e intervallo
	      narrato.
\end{itemize}

\subsection{Specifica operazioni}
Si scelgono le frequenze assumendo di tracciare una produzione narrativa
televisiva composta da 4 stagioni da 12 episodi l'una.
\begin{enumerate}
	\item Inserire un nuovo agente (in media 8 volte al mese)
	\item Inserire un nuovo intervallo (in media 80 volte al mese)
	\item Inserire una nuova fase (in media 2 volte al mese)
	\item Inserire un nuovo luogo (in media 7 volte al mese)
	\item Inserire una nuova mappa (in media 1 volta al mese)
	\item Inserire un nuovo evento(in media 160 volte al mese)
	\item Inserire una nuova unità narrativa (in media 4 volte al mese)
	\item Dato un personaggio, visualizzarne tutti gli alias (in media 8 volte al
	      mese)
	\item Dato un istante, visualizzare tutti gli agenti indicando se in vita o
	      meno(in media 4 volte al mese)
	\item Dato un luogo, visualizzare tutti quelli presenti nella stessa mappa (in
	      media 7 volte al mese)
	\item Dato un personaggio, visualizzare tutte le sue false credenze ordinate
	      cronologicamente (in media 1 volta al mese)
	\item Dato un personaggio e un evento, visualizzare eventuali intervalli di
	      tempo in cui il primo crede che sia avvenuto il secondo (in media 4
	      volte al mese)
	\item Visualizzare la fabula (in media 1 volta al mese)
	\item Visualizzare l'intreccio (in media 1 volta al mese)
\end{enumerate}


\section{Progettazione concettuale}

\subsection{Identificazione delle entità e relazioni (bottom-up)}
Si identificano le seguenti entità: personaggio, alias, intervallo,
fase, luogo, mappa, evento e unità narrativa.
Le prime due entità sono generalizzabili nell'entità agente.
\subsection{Un primo scheletro dello schema (top-down)}
% \begin{figure}
%   \includegraphics[width=0.5\linewidth]{file.eps} % assumendo che file.eps sia dentro images/
% \end{figure}
Un primo scheletro di schema concettuale è composto da quattro entità (agente,
intervallo, luogo, evento) e quattro relazioni. La relazione \emph{chi}
specifica quale agente partecipi all'evento, la relazione \emph{quando}
specifica a quale intervallo o fase appartenga l'evento, la relazione
\emph{dove} specifica in quale luogo avvenga l'evento e la relazione
\emph{credenza} descrive l'agente che crede all'evento per l'intervallo.
\subsection{Sviluppo delle componenti dello scheletro (inside-out)}

\subsection{Unione delle componenti nello schema finale ridotto}

\subsection{Dizionario dei dati}

\begin{center}\begin{tabular}{|p{0.2\textwidth-2\tabcolsep-1.2\arrayrulewidth}|p{0.4\textwidth-2\tabcolsep-1.2\arrayrulewidth}|p{0.2\textwidth-2\tabcolsep-1.2\arrayrulewidth}|p{0.2\textwidth-2\tabcolsep-1.2\arrayrulewidth}|}
		\hline
		\textbf{Nome entità} & \textbf{Descrizione}                                                               & \textbf{Attributi}                                                                                               & \textbf{Identificatore}                                     \\
		\hline
		Agente               & Personaggio o alias di un personaggio presente nella produzione narrativa          & Nome (stringa), Immagine (blob), Sesso (stringa), Istante di nascita (data e ora), Istante di morte (data e ora) & Codice (intero)                                             \\
		\hline
		Personaggio          & Personaggio presente nella produzione narrativa                                    & `` ''                                                                                                            & `` ''                                                       \\
		\hline
		Alias                & Alias di un personaggio presente nella produzione narrativa                        & `` ''                                                                                                            & `` ''                                                       \\
		\hline
		Intervallo           & Periodo temporale che occorre una volta nella produzione narrativa                 & Nome (stringa)                                                                                                   & Istante di inzio (data e ora), Istante di fine (data e ora) \\
		\hline
		Fase                 & Periodo temporale che occorre più volte ciclicamente nella produzione narrativa    & Nome (stringa)                                                                                                   & Indice (intero)                                             \\
		\hline
		Unità narrativa      & Elemento della produzione narrativa che include parte, uno o più periodi temporali & Titolo (stringa)                                                                                                 & Indice (intero)                                             \\
		\hline
		Luogo                & Luogo presente nella produzione narrativa                                          & Nome (stringa)                                                                                                   & X (reale), Y (reale), Mappa (entità in relazione)           \\
		\hline
		Mappa                & Rappresentazione grafica di uno o più luoghi presenti nella produzione narrativa   & Nome (stringa), Immagine (blob), Larghezza (reale), Altezza (reale)                                              & Codice (intero)                                             \\
		\hline
		Evento               & Ciò che avviene o è pensato essere avvenuto nella produzione narrativa             & Nome (stringa), Veridicità (booleano)                                                                            & Codice (intero)                                             \\
		\hline
	\end{tabular}\end{center}

\begin{center}\begin{tabular}{|p{0.3\textwidth-2\tabcolsep-1.2\arrayrulewidth}|p{0.2\textwidth-2\tabcolsep-1.2\arrayrulewidth}|p{0.3\textwidth-2\tabcolsep-1.2\arrayrulewidth}|p{0.2\textwidth-2\tabcolsep-1.2\arrayrulewidth}|}
		\hline
		\textbf{Nome relazione} & \textbf{Descrizione}                                                    & \textbf{Entità coinvolte}   & \textbf{Attributi}  \\
		\hline
		Mascheramento           & Associa a ogni alias uno o più personaggi                               & Personaggio, Alias          & -                   \\
		\hline
		Chi                     & Può associare eventi e agenti che vi partecipano                        & Agente, Evento              & -                   \\
		\hline
		Inclusione temporale    & Può associare fasi e intervalli che vi appartengono                     & Intervallo, Fase            & Iterazione (intero) \\
		\hline
		Narrazione              & Associa a ogni intervallo una o più unità narrative                     & Intervallo, Unità narrativa & -                   \\
		\hline
		Quando                  & Associa a ogni evento uno o più intervalli                              & Intervallo, Evento          & -                   \\
		\hline
		Collocazione            & Associa a ogni luogo una mappa                                          & Luogo, Mappa                & -                   \\
		\hline
		Dove                    & Associa a ogni evento uno o più luoghi                                  & Luogo, Evento               & -                   \\
		\hline
		Credenza                & Può associare eventi e agenti che vi credono per un intervallo di tempo & Agente, Intervallo, Evento  & -                   \\
		\hline
	\end{tabular}\end{center}


\subsection{Regole}
\begin{center}\begin{tabular}{ |l| }
		\hline
		\textbf{Regole di vincolo}                                                          \\
		\hline
		$ RV1: Agente.Sesso = M \lor Agente.Sesso = F $                                     \\
		\hline
		$RV2: Fase.Indice \geq 1 $                                                          \\
		\hline
		$RV3: InclusioneTemporale.Iterazione \geq 1 $                                       \\
		\hline
		$RV4: 0 \leq Luogo.X \leq 1 $                                                       \\
		\hline
		$RV5: 0 \leq Luogo.Y \leq 1 $                                                       \\
		\hline
		$RV6: Mappa.Larghezza > 1 $                                                         \\
		\hline
		$RV7: Mappa.Altezza > 1 $                                                           \\
		\hline
		$RV8:$ UnitàNarrativa.Indice rispetta l'espressione regolare \verb|\d+(\.\d+)*| \\
		\hline
		\textbf{Regole di derivazione}                                                      \\
		\hline
		$RD1: InVita:  = Agente.IstanteDiNascita \leq Istante \leq Agente.IstanteDiMorte$   \\
		\hline
	\end{tabular}\end{center}

\section{Progettazione logica}

\subsection{Tavole dei volumi e delle operazioni}
\subsubsection{Tavola dei volumi}
Si scelgono i volumi assumendo di tracciare una produzione narrativa
televisiva composta da 4 stagioni da 12 episodi l'una.
\begin{center}\begin{tabular}{ |c|c|c| }
		\hline
		\textbf{Concetto} & \textbf{Tipo} & \textbf{Volume} \\
		\hline
		Agente            & E             & 96              \\
		\hline
		Personaggio       & E             & 48              \\
		\hline
		Alias             & E             & 48              \\
		\hline
		Intervallo        & E             & 960             \\
		\hline
		Fase              & E             & 24              \\
		\hline
		Unità narrativa   & E             & 48              \\
		\hline
		Luogo             & E             & 84              \\
		\hline
		Mappa             & E             & 12              \\
		\hline
		Evento            & E             & 1920            \\
		\hline
	\end{tabular}\end{center}

\subsubsection{Tavola delle operazioni}
Si scelgono i volumi assumendo di tracciare una produzione narrativa
televisiva composta da 4 stagioni da 12 episodi l'una.
\begin{center}\begin{tabular}{ |c|c| }
		\hline
		\textbf{Operazione} & \textbf{Frequenza} \\
		\hline
		1                   & 8 volte al mese    \\
		\hline
		2                   & 80 volte al mese   \\
		\hline
		3                   & 2 volte al mese    \\
		\hline
		4                   & 7 volte al mese    \\
		\hline
		5                   & 1 volta al mese    \\
		\hline
		6                   & 160 volte al mese  \\
		\hline
		7                   & 4 volte al mese    \\
		\hline
		8                   & 8 volte al mese    \\
		\hline
		9                   & 4 volte al mese    \\
		\hline
		10                  & 7 volte al mese    \\
		\hline
		11                  & 1 volta al mese    \\
		\hline
		12                  & 4 volte al mese    \\
		\hline
		13                  & 1 volta al mese    \\
		\hline
		14                  & 1 volta al mese    \\
		\hline
	\end{tabular}\end{center}

\subsection{Ristrutturazione dello schema concettuale}

\subsection{Normalizzazione}
Analizzando lo schema concettuale si nota che tutte le associazioni presenti
sono in forma normale di Boyce e Codd perché ???

\subsubsection{Entità}

\begin{center}\begin{tabular}{ |c|c| }
		\hline
		\textbf{Nome entità} & \textbf{Commento} \\
		\hline
		cell5                & cell6             \\
		\hline
		cell9                & cell10            \\
		\hline
	\end{tabular}\end{center}

\subsection{Traduzione verso il modello relazionale}

\begin{center}\begin{tabular}{ |c|c| }
		\hline
		\textbf{Entità-Relazione} & \textbf{Traduzione} \\
		\hline
		cell5                     & cell6               \\
		\hline
		cell9                     & cell10              \\
		\hline
	\end{tabular}\end{center}

\begin{center}\begin{tabular}{ |c|c| }
		\hline
		\textbf{Traduzione} & \textbf{Vincoli di riferimento} \\
		\hline
		cell5               & cell6                           \\
		\hline
		cell9               & cell10                          \\
		\hline
	\end{tabular}\end{center}

\section{Codifica SQL}

\subsection{Definizione dello schema}

\sql{schema}

\subsection{Codifica delle operazioni}

\sql{operation-01}

\end{document}
